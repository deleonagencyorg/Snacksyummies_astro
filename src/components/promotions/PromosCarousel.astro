---
interface Props {
  promotion: any;
  currentLang: string;
  currentIndex?: number;
  totalItems?: number;
  onPrevious?: () => void;
  onNext?: () => void;
  isFinished?: boolean;
}

const { 
  promotion, 
  currentLang, 
  currentIndex = 0, 
  totalItems = 1,
  onPrevious,
  onNext,
  isFinished = false
} = Astro.props;

const formattedDate = (startDate: string, endDate: string) => {
  const start = new Date(startDate).toLocaleDateString(currentLang);
  const end = new Date(endDate).toLocaleDateString(currentLang);
  return `${start} - ${end}`;
};
---

<script>
  const prevButtons = document.querySelectorAll('.carousel-prev');
  const nextButtons = document.querySelectorAll('.carousel-next');
  
  prevButtons.forEach(button => {
    button.addEventListener('click', () => {
      const container = button.closest('.promo-carousel-container');
      const currentSlide = container?.querySelector('.promo-carousel-slide');
      // Add your slide navigation logic here
    });
  });
  
  nextButtons.forEach(button => {
    button.addEventListener('click', () => {
      const container = button.closest('.promo-carousel-container');
      const currentSlide = container?.querySelector('.promo-carousel-slide');
      // Add your slide navigation logic here
    });
  });
</script>

<div class="promo-carousel-container content-stretch flex flex-col gap-6 items-center justify-start relative w-full">
  <div class="content-stretch flex flex-col gap-6 items-center justify-start relative w-full">
    <div class={`promo-carousel-slide bg-white h-[471px] overflow-hidden relative rounded-[40px] w-full shadow-lg hover:shadow-xl transition-shadow ${isFinished ? 'opacity-75' : ''}`}>
      <div 
        class="absolute h-full left-0 top-0 w-[517px] bg-center bg-cover bg-no-repeat" 
        style={`background-image: url('${promotion.image.desktop}')`}
      >
        {/* Image overlay for better text contrast */}
        <div class={`absolute inset-0 bg-gradient-to-r from-transparent to-white/10 ${isFinished ? 'bg-black/20' : ''}`}></div>
        {isFinished && (
          <div class="absolute top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold z-10">
            {currentLang === 'es' ? 'Finalizada' : 'Finished'}
          </div>
        )}
      </div>
      <div class="absolute flex flex-col gap-6 h-[471px] items-center justify-center left-[517px] p-8 top-1/2 -translate-y-1/2 w-[519px]">
        <div class="flex flex-col gap-4 items-center justify-start w-full">
          <div class="flex gap-2 items-center justify-start">
            <div class="flex items-center justify-center w-6 h-6">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-black">
                <path d="M19 4h-1V3c0-.6-.4-1-1-1s-1 .4-1 1v1H8V3c0-.6-.4-1-1-1s-1 .4-1 1v1H5C3.3 4 2 5.3 2 7v12c0 1.7 1.3 3 3 3h14c1.7 0 3-1.3 3-3V7c0-1.7-1.3-3-3-3zm1 15c0 .6-.4 1-1 1H5c-.6 0-1-.4-1-1V10h16v9zm0-11H4V7c0-.6.4-1 1-1h1v1c0 .6.4 1 1 1s1-.4 1-1V6h8v1c0 .6.4 1 1 1s1-.4 1-1V6h1c.6 0 1 .4 1 1v1z"/>
              </svg>
            </div>
            <p class="text-xl text-black">
                {isFinished ? (currentLang === 'es' ? 'Finalizada' : 'Finished') : formattedDate(promotion.startDate, promotion.endDate)}
            </p>
          </div>
          <h3 class="text-3xl text-black text-center leading-tight max-w-[90%]">
            {promotion.title}
          </h3>
          {promotion.subtitle && (
            <p class="text-lg text-gray-600 text-center">
              {promotion.subtitle}
            </p>
          )}
        </div>
        
        <a 
          href={promotion.buttonUrl}
          class={`text-xl px-8 py-4 rounded-full transition-colors ${
            isFinished 
              ? 'bg-gray-500 text-white hover:bg-gray-600' 
              : 'bg-[#00306f] text-white hover:bg-blue-900'
          }`}
        >
          {currentLang === 'es' ? 'Ver detalle' : 'View detail'}
        </a>
        
        <div class="flex gap-4 items-center justify-center">
          <span class=" text-xl text-black">
            {currentLang === 'es' ? 'Comparte:' : 'Share:'}
          </span>
          <div class="flex gap-3">
            <a href="#" class="text-black hover:text-blue-600 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M13.397 20.997v-8.196h2.765l.411-3.209h-3.176V7.548c0-.926.258-1.56 1.587-1.56h1.684V3.127A22.336 22.336 0 0 0 14.201 3c-2.444 0-4.122 1.492-4.122 4.231v2.355H7.332v3.209h2.753v8.202h3.312z"/>
              </svg>
            </a>
            <a href="#" class="text-black hover:text-pink-600 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2c-2.716 0-3.056.012-4.123.06-1.064.049-1.791.218-2.427.465a4.901 4.901 0 0 0-1.772 1.153A4.902 4.902 0 0 0 2.525 5.45c-.247.636-.416 1.363-.465 2.427C2.012 8.944 2 9.284 2 12s.012 3.056.06 4.123c.049 1.064.218 1.791.465 2.427a4.902 4.902 0 0 0 1.153 1.772 4.901 4.901 0 0 0 1.772 1.153c.636.247 1.363.416 2.427.465 1.067.048 1.407.06 4.123.06s3.056-.012 4.123-.06c1.064-.049 1.791-.218 2.427-.465a4.901 4.901 0 0 0 1.772-1.153 4.902 4.902 0 0 0 1.153-1.772c.247-.636.416-1.363.465-2.427.048-1.067.06-1.407.06-4.123s-.012-3.056-.06-4.123c-.049-1.064-.218-1.791-.465-2.427a4.902 4.902 0 0 0-1.153-1.772 4.901 4.901 0 0 0-1.772-1.153c-.636-.247-1.363-.416-2.427-.465C15.056 2.012 14.716 2 12 2zm0 1.802c2.67 0 2.986.01 4.04.058.976.045 1.505.207 1.858.344.466.182.8.399 1.15.748.35.35.566.684.748 1.15.137.353.3.882.344 1.857.048 1.055.058 1.37.058 4.041 0 2.67-.01 2.986-.058 4.04-.045.976-.207 1.505-.344 1.858-.182.466-.399.8-.748 1.15-.35.35-.684.566-1.15.748-.353.137-.882.3-1.857.344-1.054.048-1.37.058-4.041.058-2.67 0-2.987-.01-4.04-.058-.976-.045-1.505-.207-1.858-.344-.466-.182-.8-.399-1.15-.748-.35-.35-.566-.684-.748-1.15-.137-.353-.3-.882-.344-1.857-.048-1.055-.058-1.37-.058-4.041 0-2.67.01-2.986.058-4.04.045-.976.207-1.505.344-1.858.182-.466.399-.8.748-1.15.35-.35.684-.566 1.15-.748.353-.137.882-.3 1.857-.344 1.055-.048 1.37-.058 4.041-.058z"/>
                <path d="M12 15.333a3.333 3.333 0 1 1 0-6.666 3.333 3.333 0 0 1 0 6.666zm0-8.468a5.135 5.135 0 1 0 0 10.27 5.135 5.135 0 0 0 0-10.27zm6.538-.203a1.2 1.2 0 1 1-2.4 0 1.2 1.2 0 0 1 2.4 0z"/>
              </svg>
            </a>
            <a href="#" class="text-black hover:text-blue-400 transition-colors">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  {/* Carousel Navigation */}
  <div class="flex gap-6 items-center justify-center mt-6">
    <button 
      class="carousel-prev w-8 h-8 flex items-center justify-center text-white hover:text-gray-200 transition-colors cursor-pointer"
      aria-label={currentLang === 'es' ? 'Anterior promoción' : 'Previous promotion'}
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    
    <div class="flex items-center gap-2">
      {Array.from({ length: totalItems }).map((_, index) => (
        <div class="w-10 h-10 flex items-center justify-center">
          <div 
            class={`w-4 h-4 rounded-full transition-colors ${index === currentIndex ? 'bg-white' : 'bg-[#a4aeb7] hover:bg-white/80'}`}
            role="button"
            aria-label={`${currentLang === 'es' ? 'Ir a promoción' : 'Go to promotion'} ${index + 1}`}
          />
        </div>
      ))}
    </div>
    
    <button 
      class="carousel-next w-8 h-8 flex items-center justify-center text-white hover:text-gray-200 transition-colors cursor-pointer"
      aria-label={currentLang === 'es' ? 'Siguiente promoción' : 'Next promotion'}
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 18l6-6-6-6"/>
      </svg>
    </button>
  </div>
</div>
