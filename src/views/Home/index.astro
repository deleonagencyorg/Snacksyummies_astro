<!-- src/views/Home/index.astro -->
---
import LazyImage from '../../components/common/LazyImage.astro';
import { t, getLocale } from '../../i18n/i18n';
import Carousel from '../../components/common/Carousel/index.astro';
import RecipeCard from '../../components/recipes/RecipeCard.astro';
import './styles.css';

// Obtener idioma actual
const currentLang = getLocale();
// Precargar namespaces
t('common', { locale: currentLang });
t('recipes', { locale: currentLang });
t('news', { locale: currentLang });
t('products', { locale: currentLang });

export interface Props {
  currentLang: string;
  loading?: boolean;
}

const { loading = false } = Astro.props;
const spotifyAssets = t('home.spotify', { namespace: 'common', locale: currentLang }) || {};
const recipesAssets = t('home', { namespace: 'recipes', locale: currentLang }) || {};
const recipeItems = t('items', { namespace: 'recipes', locale: currentLang }) || [];
const deliveryAssets = t('home.delivery', { namespace: 'common', locale: currentLang }) || {};
console.log('spotifyAssets', spotifyAssets)
const commonAssets = t('assets.slider', { namespace: 'common', locale: currentLang }) || [];
const slides = Array.isArray(commonAssets) 
  ? commonAssets
    .filter(asset => asset && typeof asset === 'object' && asset.desktop && asset.mobile)
    .map(asset => ({
      desktop: asset.desktop,
      mobile: asset.mobile,
      alt: asset.alt || 'Taqueritos',
      title: asset.title || '',
      subtitle: asset.description || '',
      link: asset.url || asset.link || ''
    }))
  : [];



---

  <main class="w-full flex flex-col items-center justify-center">
    <!-- Slider Section -->
    <div class="w-full flex justify-center">
      <Carousel slides={slides} />
    </div>
    
    <!-- Preconnect to Spotify for faster loading -->
    <link rel="preconnect" href="https://open.spotify.com" />
    
    <!-- Spotify Section -->
    <section id="spotify" class="w-full py-12 flex flex-col items-center justify-center" style="margin-top: -1rem;">
      <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-8 px-8 py-8 w-full">
        <div class="w-full md:w-1/2 flex justify-center items-center gap-8">
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/notamusical1.webp" alt="Spotify Listen In" class="w-8 object-cover object-center"/>
          <h2 class="text-4xl font-normal text-center text-white">TAQUE MUSIC</h2>
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/notamusical2.webp" alt="Spotify Listen In" class="w-8 object-cover object-center"/>
        </div>
        <div class="w-full md:w-1/2 flex justify-center items-center">
          <LazyImage src={spotifyAssets.listen_in_spotify} alt="Spotify Listen In" class="w-64 object-cover object-center"/>
        </div>
      </div>
      <div class="flex flex-wrap items-center justify-center gap-6 md:gap-20 px-8">
        <div class="flex-1 min-w-[250px] w-[250px] md:w-[295px] flex flex-col items-center justify-center">
          <div class="spotify-skeleton w-[295px] h-[380px] bg-gray-200 rounded-lg mb-4"></div>
          <iframe loading="lazy" data-src="https://open.spotify.com/embed/show/74U81Bi7EbCWN7AOtVvTaU?si=dd28c5c6af7f4258" width="100%" height="380" frameborder="0" allowtransparency="true" allow="encrypted-media" class="hidden"></iframe>
          <p class="py-6" >
            <a href="https://open.spotify.com/show/74U81Bi7EbCWN7AOtVvTaU?si=421241783ab142e4&nd=1" target="_blank" rel="noopener noreferrer">
              <LazyImage src={spotifyAssets.button_listen_now} alt="Spotify Logo" class="md:w-56 w-48" />
            </a>
          </p>
        </div>
        <div class="flex-1 min-w-[250px] w-[250px] md:w-[295px] flex flex-col items-center justify-center">
          <div class="spotify-skeleton w-full max-w-[295px] h-[380px] bg-gray-200 rounded-lg mb-4"></div>
          <iframe loading="lazy" data-src="https://open.spotify.com/embed/playlist/1ol88nHjokvzBvWgCkBDi9?utm_source=generator" width="100%" height="380" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" class="hidden"></iframe>
          <p class="py-6" >
            <a href="https://open.spotify.com/playlist/1ol88nHjokvzBvWgCkBDi9" target="_blank" rel="noopener noreferrer">
              <LazyImage src={spotifyAssets.button_listen_now} alt="Spotify Logo" class="md:w-56 w-48" />
            </a>
          </p>
        </div>
        <div class="flex-1 min-w-[250px] w-[250px] md:w-[295px] flex flex-col items-center justify-center">
          <div class="spotify-skeleton w-full max-w-[300px] h-[380px] bg-gray-200 rounded-lg mb-4"></div>
          <iframe loading="lazy" data-src="https://open.spotify.com/embed/playlist/3EkdIhlaXStL5aYJPn0lmY?utm_source=generator" width="100%" height="380" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" class="hidden"></iframe>
          <p class="py-6">
            <a href="https://open.spotify.com/playlist/3EkdIhlaXStL5aYJPn0lmY" target="_blank" rel="noopener noreferrer">
              <LazyImage src={spotifyAssets.button_listen_now} alt="Spotify Logo" class="md:w-56 w-48" />
            </a>
          </p>
        </div>
        <div class="flex-1 min-w-[250px] w-[250px] md:w-[295px] flex flex-col items-center justify-center">
          <div class="spotify-skeleton w-full max-w-[300px] h-[380px] bg-gray-200 rounded-lg mb-4"></div>
          <iframe loading="lazy" data-src="https://open.spotify.com/embed/playlist/0LkNti3jTDqdFODqfI6F3j?utm_source=generator" width="100%" height="380" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" class="hidden"></iframe>
          <p class="py-6">
            <a href="https://open.spotify.com/playlist/0LkNti3jTDqdFODqfI6F3j" target="_blank" rel="noopener noreferrer">
              <LazyImage src={spotifyAssets.button_listen_now} alt="Spotify Logo" class="md:w-56 w-48" />
            </a>
          </p>
        </div>
      </div>
    </section>

    <!-- Delivery Section -->
    {getLocale() === 'es' && (
      <section id="delivery" class="w-full py-12 flex flex-col items-center justify-center">
        <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-8 px-8 py-8 w-full">
          <div class="w-full md:w-1/2 flex justify-center items-center gap-8">
            <LazyImage src={deliveryAssets.delivery_icon_left} alt="Taqueritos Delivery" class="md:w-90 w-90 object-cover object-center"/>
          
          </div>
          <div class="w-full md:w-1/2 flex flex-col justify-center items-center">
            <div class="flex flex-col md:flex-row items-center md:items-end gap-4 mb-2">
              <div class="flex flex-col items-center md:hidden">
                <LazyImage src={deliveryAssets.delivery_icon_right} alt="Taqueritos Delivery" class="w-20 object-cover object-center"/>
                <h2 class="text-4xl font-normal text-center text-white">TAQUERITOS</h2>
              </div>
              <div class="hidden md:flex items-end gap-4">
                <h2 class="text-4xl font-normal text-left text-white">TAQUERITOS</h2>
                <LazyImage src={deliveryAssets.delivery_icon_right} alt="Taqueritos Delivery" class="w-20 object-cover object-center"/>
              </div>
            </div>
            <h2 class="text-4xl font-normal text-center md:text-left text-white">A LA PUERTA DE TU CASA</h2>
            <p class="w-full md:w-[80%] text-lg font-normal text-center text-white py-6">El servicio de delivery de PedidosYa se encuentra disponible únicamente para el área de Tegucigalpa</p>
            <div class="flex flex-row items-center gap-4 mb-2">
              <a href="https://hugoapp.app.link/tsGW7qeq55?_p=c11c36dc990560eee31d88e3e9b4b8" target="_blank" rel="noopener noreferrer">
                <LazyImage src={deliveryAssets.hugo_app_icon} alt="Taqueritos por Hugo App" class="w-20 object-cover object-center"/>
              </a>
              <a href="https://hugoapp.app.link/tsGW7qeq55?_p=c11c36dc990560eee31d88e3e9b4b8" target="_blank" rel="noopener noreferrer" class="px-6 py-2 bg-white text-purple-600 font-medium rounded-full shadow-md hover:bg-blue-100 transition-colors duration-300 flex items-center justify-center">
                <span class="mr-2">Comprar ahora</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </a>
            </div>
            <div class="flex flex-row items-center gap-4 mb-2">
              <a href="https://play.google.com/store/apps/details?id=io.beanar.ocho&hl=es_GT&gl=US" target="_blank" rel="noopener noreferrer">
                <LazyImage src={deliveryAssets.ocho_app_icon} alt="Taqueritos por Ocho App" class="w-20 object-cover object-center"/>
              </a>
              <a href="https://play.google.com/store/apps/details?id=io.beanar.ocho&hl=es_GT&gl=US" target="_blank" rel="noopener noreferrer" class="px-6 py-2 bg-white text-orange-600 font-medium rounded-full shadow-md hover:bg-blue-100 transition-colors duration-300 flex items-center justify-center">
                <span class="mr-2">Comprar ahora</span>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
              </a>
            </div>
            
          </div>
        </div>
      </section>
    )}

  <section id="recipes" class="w-full py-12 flex flex-col items-center justify-center">
    <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-8 px-8 py-8 w-full">
      <div class="w-full md:w-1/2 flex flex-col justify-center items-center gap-4">
        <div class="flex flex-row items-center gap-8">
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/Sal.webp" alt="Sal" class="w-12 object-cover object-center"/>
          <h2 class="text-5xl font-normal text-center text-white">TAQUE</h2>
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/pimienta.webp" alt="Pimienta" class="w-12 object-cover object-center"/>
        </div>
        <h2 class="text-5xl font-normal text-center text-white">RECETAS</h2>
        <p>
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/sarten.webp" alt="Recetas" class="w-80 object-cover object-center"/>
        </p>
      </div>
      <div class="w-full md:w-1/2 flex justify-center items-center">
        <a href={recipesAssets.explore_more.link} target="_blank" rel="noopener noreferrer" class="px-6 py-2 border border-white text-white font-medium rounded-full shadow-md hover:bg-blue-100 transition-colors duration-300 flex items-center justify-center">
          <span class="mr-2">{recipesAssets.explore_more.title}</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </a>
        <div id="allrecipes" class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto px-4">
    {recipeItems.slice(0, 2).map((recipe: {
      id: string;
      title: string;
      image: string;
      preparation_time: number;
    }) => (
      <RecipeCard
        image={recipe.image}
        title={recipe.title}
        time={`${recipe.preparation_time}MIN`}
        id={recipe.id}
        textColor="text-green-700"
        iconColor="text-green-600"
      />
    ))}
  </div>
      </div>
    </div>
    <div class="w-full flex flex-col md:flex-row items-center justify-center gap-6 md:gap-8 px-8 py-8 text-white font-bold text-4xl font-sans font-weight-bold">
      <span>{recipesAssets.visit_text_1.title}</span>
      <a href={recipesAssets.visit_1.link} target="_blank" rel="noopener noreferrer" class="text-red">{recipesAssets.visit_1.title}</a>
      <span>{recipesAssets.visit_text_2.title}</span>
      <a href={recipesAssets.visit_2.link} target="_blank" rel="noopener noreferrer" class="text-red">{recipesAssets.visit_2.title}</a>
      {getLocale() === 'en' && (<span>{recipesAssets.visit_text_3.title}</span>
    <a href={recipesAssets.visit_3.link} target="_blank" rel="noopener noreferrer" class="text-red">{recipesAssets.visit_3.title}</a>
    )}
    </div>
  </section>
    <script is:inline>
      document.addEventListener('DOMContentLoaded', () => {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              const iframe = entry.target.querySelector('iframe');
              if (iframe) {
                iframe.src = iframe.dataset.src;
                iframe.classList.remove('hidden');
                entry.target.querySelector('.spotify-skeleton').remove();
                observer.unobserve(entry.target);
              }
            }
          });
        }, { rootMargin: '200px' });

        document.querySelectorAll('#spotify > div > div').forEach(container => {
          observer.observe(container);
        });
      });
    </script>

  </main>
