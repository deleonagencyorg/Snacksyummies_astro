<!-- src/views/Home/index.astro -->
---
import LazyImage from '../../components/common/LazyImage.astro';
import { t } from '../../i18n/i18n';
import type { Locale } from '../../i18n/i18n';
import { getLocale } from '../../i18n/i18n';
import Carousel from '../../components/common/Carousel/index.astro';
import RecipeCard from '../../components/recipes/RecipeCard.astro';
import RecipesCarousel from '../../components/recipes/RecipesCarousel.astro';
import Newsletter from '../../components/common/Newsletter/index.astro';
import FloatingChip from '../../components/common/FloatingChip/index.astro';
import SocialMediaIcons from '../../components/common/SocialMediaIcons/index.astro';
import './styles.css';
import NewProductsCarousel from '../../components/common/NewProductsCarousel/index.astro';
import SimpleProductCarousel from '../../components/common/SimpleProductCarousel/index.astro';
import CrownTitle from '../../components/common/CrownTitle/CrownTitle.astro';
import AnimHeart from '../../components/common/AnimHeart/index.astro';
import ChipsFromBag from '../../components/common/ChipsFromBag/index.astro';
import InstagramEmbed from '../../components/common/InstagramEmbed/index.astro';
import Delivery from '../../components/common/Delivery/index.astro';

// Add styles for active brand logo
const activeLogoStyles = `
  .active-brand {
    box-shadow: 0 0 10px rgba(0,0,0,0.5);
    opacity: 0.5;
    z-index: 10;
    border-width: 4px !important;
    transform: scale(1.1);
    transition: transform 0.3s ease;
  }
`;

export interface Props {
  loading?: boolean;
}
const { loading = false } = Astro.props;

// Obtener idioma actual y exportarlo para que esté disponible en el template
const currentLang = getLocale();

// Precargar namespaces con validación
t('common', { locale: currentLang }) || {};
t('recipes', { locale: currentLang }) || {};
t('news', { locale: currentLang }) || {};
t('products', { locale: currentLang }) || {};
t('newproducts', { locale: currentLang }) || {};
t('brands', { locale: currentLang }) || {};
t('promotions', { locale: currentLang }) || {};
t('contentN', { locale: currentLang }) || {};
t('chips', { locale: currentLang }) || {};


// Cargar productos nuevos con validación
const newProducts = t('products', { namespace: 'newproducts', locale: currentLang }) || [];

// Los datos de marcas ya están definidos más abajo

const validProducts = Array.isArray(newProducts) ? newProducts : [];

const chips = t('chips', { namespace: 'newproducts', locale: currentLang }) || [];
const brands = t('brands', { namespace: 'brands', locale: currentLang }) || [];

// Obtener promos dummy para la Home (solo ES)
const promotionsData = t('promotions', { namespace: 'promotions', locale: currentLang }) || [];
const sectionsData = t('sections', { namespace: 'promotions', locale: currentLang }) || {};
const activePromotions = Array.isArray(promotionsData)
  ? promotionsData.filter((promo: any) => promo?.status === 'active')
  : [];
const featuredPromotions = activePromotions.slice(0, 2);

const homeAssets = t('home', { namespace: 'common', locale: currentLang }) || {};
const recipesAssets = t('home', { namespace: 'recipes', locale: currentLang }) || {};
const recipeItems = t('items', { namespace: 'recipes', locale: currentLang }) || [];

// Obtener datos de delivery
const deliveryData = homeAssets.delivery || {};

// Obtener las imágenes de máscara del slider desde los archivos de idioma (desktop y mobile)
const sliderMask = t('assets.slidermask', { namespace: 'common', locale: currentLang }) || 'https://snack.yummiespromociones.com/snacksyummies/bg-front.webp';
const sliderMaskMobile = t('assets.slidermaskmobile', { namespace: 'common', locale: currentLang }) || 'https://snack.yummiespromociones.com/snacksyummies/bg-front-mobile_1_.webp';

// Cargar recetas usando el mismo patrón que la página de Recetas
interface RecipeItem {
  id: string;
  title: string;
  image?: string;
  preparation_time: number;
  slug?: string;
}

const recipeModules = import.meta.glob<{default: RecipeItem}>("../../locales/*/recipes/*.json");
const allRecipes: RecipeItem[] = [];
for (const path in recipeModules) {
  const lang = path.split('/')[3];
  if (lang === currentLang) {
    const mod = await recipeModules[path]();
    allRecipes.push(mod.default);
  }
}
const topRecipes = allRecipes.slice(0, 9);
const listingPath = `/${currentLang}/${currentLang === 'es' ? 'recetas' : 'recipes'}`;


const commonAssets = t('assets.slider', { namespace: 'common', locale: currentLang }) || [];
const slides = Array.isArray(commonAssets) 
  ? commonAssets
    .filter(asset => asset && typeof asset === 'object' && asset.desktop && asset.mobile)
    .map(asset => ({
      desktop: asset.desktop,
      mobile: asset.mobile,
      alt: asset.alt || 'Snacks Yummies',
      title: asset.title || '',
      subtitle: asset.description || '',
      link: asset.url || asset.link || ''
    }))
  : [];



---

  <main class="w-full flex flex-col items-center justify-center mt-0">
    <!-- Slider Section con máscara -->
    <div class="relative w-full overflow-hidden max-w-[100vw] h-auto aspect-[1/1] md:aspect-[21/9] lg:h-[66vh]">
      <!-- Título superpuesto posicionado a la izquierda y centrado verticalmente -->
      <!-- div class="absolute left-8 top-1/2 transform -translate-y-1/2 z-20 hidden md:block">
        <LazyImage 
          src="https://snack.yummiespromociones.com/snacksyummies/Header-Title.webp" 
          alt="Título decorativo" 
          class="md:w-40 lg:w-80 object-cover object-center" 
        />
      </div>
      
      <!-- Máscara PNG superpuesta (cambia según el idioma y dispositivo) -->
      <!-- <div class="absolute inset-0 z-10 pointer-events-none w-screen left-0 right-0">
        <img src={sliderMask} alt="Máscara decorativa" class="hidden md:block w-full h-full object-cover object-center" />
        <img src={sliderMaskMobile} alt="Máscara decorativa" class="md:hidden w-full h-full object-cover object-center" />
      </div> -->
      
      <!-- Slider posicionado más a la derecha en desktop, full width en móvil 
      <div class="relative z-0 w-full md:w-[80%] md:ml-auto">
        <Carousel slides={slides} />
       
      </div>-->

      <div class="relative z-0 w-full md:w-[100%] md:ml-auto md:h-full h-[72vh] md:flex md:items-center md:justify-center">
        <Carousel slides={slides} />
      </div>
    </div>
    
 

    <!-- Sección de Carrusel Orbital de Productos -->
    <section id="new-products" class="w-full  bg-gradient-to-b from-secondary to-blue-700 relative pb-8 ">
      {currentLang === 'es' && (
      <div class="hidden md:flex absolute w-full justify-end pr-4 md:pr-8 -mt-16 z-30">
        <div class="animate-spin-slow">
          <LazyImage 
            src="https://snack.yummiespromociones.com/SnacksyummiesAssets/Seal.webp" 
            alt="Sello de calidad Snacks Yummies - Marca líder en Centroamérica" 
            class="w-20 md:w-32 lg:w-40 object-cover object-center" 
          />
        </div>
      </div>
    )}
      <div class="container mx-auto px-4">
        <FloatingChip
                      src={chips[0]}
                      alt="Snack crujiente Taqueritos flotante"
                      size="2xl"
                      position="top: 25%; left: 15%;"
                      mobilePosition="top: 25%; left: 15%;"
                      animationDuration={15}
                    />
                    <FloatingChip
                    src={chips[1]}
                    alt="Chip"
                    size="2xl"
                    position="top: 25%; left: 25%;"
                    animationDuration={15}
                  />
                  <FloatingChip
                    src={chips[2]}
                    alt="Chip"
                    size="2xl"
                    position="top: 25%; left: 60%;"
                    animationDuration={15}
                  />
                  <FloatingChip
                  src={chips[3]}
                  alt="Chip"
                  size="4xl"
                  position="top: 75%; right: 15%;"
                  mobilePosition="top: 75%; right: 7%;"
                  animationDuration={15}
                />
                <FloatingChip
                src={chips[4]}
                alt="Chip"
                size="2xl"
                position="top: 75%; right: 50%;"
                mobilePosition="top: 95%; right: 75%;"
                animationDuration={15}
              />
              <FloatingChip
                src={chips[5]}
                alt="Chip"
                size="xl"
                position="top: 65%; right: 75%;"
                mobilePosition="top: 95%; right: 75%;"
                animationDuration={15}
              />
        <!-- Top floating chips -->
        
        
        <div class="mb-8 p-4 relative">
          <div class="flex flex-col items-center">
            <div class="relative">
              <span class="inline-block md:text-[3rem] text-[1.5rem] rotate-[-12deg] font-title uppercase font-semibold text-white bg-red py-1 px-6 rounded-full z-10 absolute top-0 left-0 transform -translate-x-[1rem] md:-translate-x-[4rem] translate-y-[-1rem] md:translate-y-[-1rem]">
                {homeAssets.new_products.tagtitle}</span>
              <h2 class="md:text-[8rem] text-[4rem] font-title uppercase text-white font-bold text-center mt-[1rem] md:mt-0">{homeAssets.new_products.title}</h2>
            </div>
          </div>
        </div>
        
        <!-- Base image positioned behind carousel -->
    
        
        <!-- Original Carousel -->
        <!-- <NewProductsCarousel products={validProducts} className="z-1" /> -->
        
        <!-- Simple Product Carousel -->
        <SimpleProductCarousel 
          products={validProducts}
          class="z-10 w-full max-w-5xl mx-auto my-8 relative md:mt-[-4rem]"
        />
        <!-- Bottom floating chips -->
        <div id="base" class="w-full flex items-center justify-center absolute z-0 md:ml-[-6rem]">
          <div class="md:w-[60%] w-full mx-auto">
            <LazyImage src="https://snack.yummiespromociones.com/snacksyummies/basenewproducts.webp" alt="Base de productos nuevos" 
            class="w-full translate-y-[-12rem] md:translate-y-[-18rem]" />
          </div>
        </div>
      </div>
    </section>

    <!-- {currentLang === 'es' && featuredPromotions.length > 0 && (
      <section id="promociones" class="w-full bg-[#1A649E] py-16">
        <div class="container mx-auto px-4">
          <h2 class="text-4xl md:text-6xl font-title font-semibold text-center text-white mb-10">
            {sectionsData.active?.title || 'Promociones activas'}
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-6xl mx-auto">
            {featuredPromotions.map((promotion: any) => (
              <div class="bg-white rounded-[32px] overflow-hidden shadow-lg">
                <div class="w-full aspect-[16/9] bg-gray-100">
                  <LazyImage
                    src={promotion?.image?.desktop || 'https://snack.yummiespromociones.com/SnacksyummiesAssets/placeholder.webp'}
                    alt={promotion?.image?.alt || promotion?.title || 'Promoción'}
                    class="w-full h-full object-cover"
                  />
                </div>

                <div class="p-6 md:p-8 flex flex-col gap-4">
                  <h3 class="text-2xl md:text-3xl font-sans text-black text-center leading-tight">
                    {promotion?.title}
                  </h3>

                  {promotion?.subtitle && (
                    <p class="text-sm md:text-base text-gray-600 text-center">
                      {promotion.subtitle}
                    </p>
                  )}

                  <div class="flex justify-center pt-2">
                    <a
                      href={promotion?.buttonUrl || '/es/promociones'}
                      class="text-lg px-8 py-3 rounded-full bg-[#00306f] text-white hover:bg-blue-900 transition-colors"
                    >
                      {promotion?.buttonText || 'Ver detalle'}
                    </a>
                  </div>
                </div>
              </div>
            ))}
          </div>

          <div class="flex justify-center mt-10">
            <a
              href="/es/promociones"
              class="px-6 py-3 bg-white text-blue-700 font-semibold rounded-full shadow hover:shadow-md"
            >
              Ver todas las promociones
            </a>
          </div>
        </div>
      </section>
    )} -->

    <!-- Sección de recetas: Slider -->
    <section id="recipes" class="w-full py-12 mb-8" transition:animate="slide">
      <div class="container mx-auto px-4">
        <h2 class="text-4xl md:text-6xl font-title font-semibold text-center text-white mb-8">
          {currentLang === 'es' ? 'Recetas' : 'Recipes'}
        </h2>

        <!-- Slider wrapper -->
        <div class="relative max-w-6xl mx-auto">
          <!-- Slides viewport -->
          <div id="recipes-viewport" class="overflow-hidden rounded-2xl">
            <div id="recipes-track" class="flex gap-12 transition-transform duration-500 ease-out" style="will-change: transform;">
              {topRecipes.map((recipe: RecipeItem) => (
                <div class="flex-shrink-0 box-border">
                  <RecipeCard
                    image={recipe.image || 'https://snack.yummiespromociones.com/SnacksyummiesAssets/placeholder.webp'}
                    title={recipe.title}
                    time={`${recipe.preparation_time}MIN`}
                    id={recipe.id}
                    slug={recipe.slug}
                    textColor="text-white"
                    iconColor="text-white"
                  />
                </div>
              ))}
            </div>
          </div>

          <!-- Controls: centered, white -->
          <div class="flex items-center justify-center gap-4 mt-6">
            <button id="recipes-prev" class="w-10 h-10 rounded-full bg-white text-blue-700 font-bold grid place-items-center shadow hover:shadow-md" aria-label="Previous">‹</button>
            <div id="recipes-dots" class="flex items-center gap-2"></div>
            <button id="recipes-next" class="w-10 h-10 rounded-full bg-white text-blue-700 font-bold grid place-items-center shadow hover:shadow-md" aria-label="Next">›</button>
          </div>

          <!-- View all centered -->
          <div class="flex justify-center mt-8">
            <a href={listingPath} class="px-6 py-3 bg-white text-blue-700 font-semibold rounded-full shadow hover:shadow-md">
              {currentLang === 'es' ? 'Ver todas' : 'View all'}
            </a>
          </div>
        </div>
      </div>
    </section>

  <section id="brands" class="w-full mt-[-2rem] " aria-labelledby="brands-heading">
    <div class="container mx-auto my-8 px-6 md:mx-0 uppercase ">
      <h2 id="brands-heading" class="sr-only">{homeAssets.brands.title}</h2>
      <CrownTitle title={homeAssets.brands.title} subtitle="" transition:name="brands-title" />
    </div>
    <div class="md:flex md:items-center md:justify-between mt-[2rem]md:mt-[0rem] ">
      <div id="logosbrands" class="md:w-1/2 flex flex-col px-4 md:px-0 items-center justify-center md:order-2 ">
        <div class="brands-grid">
          {brands.map((brand: any, index: number) => (
            <div 
              class="logo-brand"
              style={{ backgroundColor: brand.bgColor }}
              data-image={brand.image}
              data-image-mobile={brand.imageMobile}
              data-title={brand.title}
              onclick={`updateBrandPreview('${brand.image}', '${brand.imageMobile}', '${brand.title}'); highlightSelectedBrand(this, '${brand.bgColor}')`}
              ontouchstart={`updateBrandPreview('${brand.image}', '${brand.imageMobile}', '${brand.title}'); highlightSelectedBrand(this, '${brand.bgColor}')`}
            >
              <LazyImage
                src={brand.logo}
                alt={brand.title}
                class="brand-logo-img"
              />
            </div>
          ))}
        </div>
      </div>
      <div id="previewbrand" class="mt-6 md:w-1/2 flex items-center justify-center md:order-1 relative md:mt-[2rem]">
        <div id="floating-images-container" class="absolute inset-0 z-10 pointer-events-none overflow-visible md:mt-[-4rem]">
          <ChipsFromBag 
            imageUrl={brands[0].imageChip1}
            count={20}
            baseSize={100}
            sizeVariation={40}
            containerWidth="80%"
            containerHeight="60%"
            alt="Chips de marca premium flotando - experiencia interactiva"
            burstOnHover={true}
            burstCount={8}
            mobileCount={10}
            mobileBaseSize={3}
            mobileContainerWidth="90vw"
            mobileContainerHeight="50vh"
          />
        </div>
        <LazyImage
          id="brand-preview-img"
          src={brands[0].image}
          alt={brands[0].title}
          class="hidden md:block w-full h-auto object-contain transition-opacity duration-300 md:mt-[2rem]"
        />
        <LazyImage
          id="brand-preview-img-mobile"
          src={brands[0].imageMobile}
          alt={brands[0].title}
          class="md:hidden w-full h-auto object-contain transition-opacity duration-300"
        />
      </div>
    </div>
    <script define:vars={{brands}}>
      // Exponer los datos de las marcas para JavaScript
      window.brandsData = brands.map(brand => ({
        title: brand.title,
        image: brand.image,
        imageMobile: brand.imageMobile,
        imageChip1: brand.imageChip1,
        imageChip2: brand.imageChip2,
        imageChip3: brand.imageChip3,
        imageChip4: brand.imageChip4
      }));

      // Función global para actualizar la imagen de preview y los chips
      function updateBrandPreview(imageUrl, mobileImageUrl, title) {
        const previewImg = document.getElementById('brand-preview-img');
        const previewImgMobile = document.getElementById('brand-preview-img-mobile');
        
        // Obtener la marca seleccionada por su imagen
        const selectedBrand = Array.from(document.querySelectorAll('.logo-brand')).find(logo => {
          return logo.getAttribute('data-image') === imageUrl;
        });
        
        if (previewImg) {
          previewImg.src = imageUrl;
          previewImg.alt = title || '';
        }
        
        if (previewImgMobile) {
          previewImgMobile.src = mobileImageUrl;
          previewImgMobile.alt = title || '';
        }
        
        // Actualizar la imagen de los chips
        if (selectedBrand) {
          // Encontrar el índice de la marca seleccionada
          const brandIndex = Array.from(document.querySelectorAll('.logo-brand')).indexOf(selectedBrand);
          
          // Actualizar el componente ChipsFromBag con la nueva imagen
          const chipsContainer = document.getElementById('floating-images-container');
          if (chipsContainer && brandIndex !== -1 && window.brandsData && window.brandsData[brandIndex]) {
            const brandData = window.brandsData[brandIndex];
            if (brandData && brandData.imageChip1) {
              // Actualizar todas las imágenes de chips
              const chipImages = chipsContainer.querySelectorAll('.chip img');
              chipImages.forEach(img => {
                img.src = brandData.imageChip1;
                img.alt = brandData.title || 'Chip flotante';
              });
            }
          }
        }
      }
      
      // Function to highlight the selected brand logo
      function highlightSelectedBrand(element, bgColor) {
        // Remove highlight from all logos
        const allLogos = document.querySelectorAll('.logo-brand');
        allLogos.forEach(logo => {
          logo.style.borderColor = 'transparent';
          logo.style.transform = 'scale(1)';
          logo.classList.remove('active-brand');
        });
        
        // Add highlight to the selected logo
        element.style.borderColor = bgColor;
        element.style.borderOpacity = '0.3';
        element.style.transform = 'scale(1.1)';
        element.classList.add('active-brand');
      }
      
      // Initialize the first brand as selected when the page loads
      document.addEventListener('DOMContentLoaded', function() {
        const firstBrand = document.querySelector('.logo-brand');
        if (firstBrand) {
          const bgColor = firstBrand.style.backgroundColor;
          highlightSelectedBrand(firstBrand, bgColor);
        }
      });
      
      // Asegurarse de que la función esté disponible globalmente
      window.updateBrandPreview = updateBrandPreview;
      window.highlightSelectedBrand = highlightSelectedBrand;
    </script>
   
        
       
      </div>
    </div>
  </section>

  {currentLang === 'es' && (
    <Delivery 
      deliveryTitle={deliveryData.delivery_title || "Dónde"}
      deliverySubTitle={deliveryData.delivery_sub_title || "Encontrarnos"}
      deliveryApps={deliveryData.delivery_apps || []}
    />

  )}


  <section id="socialmedia" class="bg-quinary w-full py-12 flex flex-col items-center justify-center">
    
    <div class="container mx-auto px-4">
      <!-- Mobile: Content first, then all 4 posts below -->
      <div class="md:hidden">
        <!-- Center Content -->
        <div id="socialmedia-title-mobile" class="flex flex-col items-center justify-center relative w-full mx-auto mb-8">
          <div class="absolute inset-0 z-0 mt-[-8rem]">
            <AnimHeart count={20} containerClass="h-[50vh] w-full" />
          </div>
          
          <p class="text-primary text-center pt-4 font-title uppercase font-bold text-[3rem] z-10 mb-4">{homeAssets.socialmedia.title}</p>
          <p class="text-white text-center font-title uppercase font-bold text-[2rem] mt-[-2rem] bg-red px-6 rounded-full z-10">{homeAssets.socialmedia.tagtitle}</p>

          <SocialMediaIcons 
            currentLang={currentLang} 
            iconColor='#0A3D7E' 
            iconSize={42} 
            centered={true}
            class="mt-4 w-full z-10" 
          />
          <p class="text-primary text-center pt-4 z-10 px-4">{homeAssets.socialmedia.newsletter}</p>
          <Newsletter 
            placeholder={homeAssets.newsletter.placeholder}
            buttonText={homeAssets.newsletter.buttonText}
            centered={true}
            class="mt-4 w-full mb-4 z-10"
          />
        </div>

        <!-- All 4 posts below in 2x2 grid -->
        <div class="grid grid-cols-2 gap-2">
          <div class="insta-wrap insta-wrap--mobile">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[0].url} width="100%" height="100%" />
          </div>
          <div class="insta-wrap insta-wrap--mobile">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[1].url} width="100%" height="100%" />
          </div>
          <div class="insta-wrap insta-wrap--mobile">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[2].url} width="100%" height="100%" />
          </div>
          <div class="insta-wrap insta-wrap--mobile">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[3].url} width="100%" height="100%" />
          </div>
        </div>
      </div>

      <!-- Desktop/Tablet: Side Layout (posts on sides of content) -->
      <div class="hidden md:flex flex-row items-center justify-center gap-4">
        <!-- Instagram Posts - Left Side -->
        <div id="instagram1" class="flex flex-col items-center justify-center">
          <div class="insta-wrap insta-wrap--desktop z-0 mb-4">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[0].url} width="100%" height="100%" />
          </div>

          <div class="insta-wrap insta-wrap--desktop z-10 mt-4 translate-y-[-6rem] translate-x-[2rem]">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[1].url} width="100%" height="100%" />
          </div>
        </div>

        <!-- Center Content -->
        <div id="socialmedia-title" class="flex flex-col items-center justify-center relative w-full mx-auto">
          <div class="absolute inset-0 z-0 mt-[-2rem]">
            <AnimHeart count={20} containerClass="h-[50vh] w-full" />
          </div>
          
          <p class="text-primary text-center pt-4 font-title uppercase font-bold md:text-[4rem] lg:text-[8rem] z-10 mb-4">{homeAssets.socialmedia.title}</p>
          <p class="text-white text-center font-title uppercase font-bold text-[3rem] mt-[-3rem] bg-red px-6 rounded-full z-10">{homeAssets.socialmedia.tagtitle}</p>

          <SocialMediaIcons 
            currentLang={currentLang} 
            iconColor='#0A3D7E' 
            iconSize={42} 
            centered={true}
            class="mt-4 w-full z-10" 
          />
          <p class="text-primary text-center pt-4 z-10 px-4">{homeAssets.socialmedia.newsletter}</p>
          <Newsletter 
            placeholder={homeAssets.newsletter.placeholder}
            buttonText={homeAssets.newsletter.buttonText}
            centered={true}
            class="mt-4 w-full mb-4 z-10"
          />
        </div>

        <!-- Instagram Posts - Right Side -->
        <div id="instagram2" class="flex flex-col items-center justify-center">
          <div class="insta-wrap insta-wrap--desktop z-0 mb-4">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[2].url} width="100%" height="100%" />
          </div>

          <div class="insta-wrap insta-wrap--desktop z-10 mt-4 translate-y-[-6rem] translate-x-[-2rem]">
            <InstagramEmbed postUrl={homeAssets.socialmedia.instagramLinks[3].url} width="100%" height="100%" />
          </div>
        </div>
      </div>
    </div>
    <svg width="100%" height="87" fill="#4895CE" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1442 57" preserveAspectRatio="none" class="-translate-y-[3rem] md:-translate-y-[3rem] w-full z-10 translate-y-0">
      <path d="M0 65V0.5C850 129 1440 0.5 1440 0.5V65H0Z" />
    </svg>
  </section>
  <style>
    /* Instagram responsive sizing rules */
    /* Base: border-radius + overflow para todos los wraps */
    .insta-wrap {
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }

    /*
     * Alturas = (ancho × 16/9) + 130px de chrome de Instagram
     * Chrome = header (avatar+username ~56px) + "Ver más en Instagram" (~36px) + action bar (like/comment/share ~38px)
     * Desktop  250px: (250 × 1.778) + 130 ≈ 574px
     * Tablet   150px: (150 × 1.778) + 130 ≈ 397px
     */

    /* Desktop ≥1332px: ancho 250px, altura 574px */
    .insta-wrap--desktop {
      width: 250px;
      height: 574px;
    }

    /* Tablet 768–1331px: ancho 150px, altura 397px */
    @media (max-width: 1331px) and (min-width: 768px) {
      .insta-wrap--desktop {
        width: 150px;
        height: 397px;
      }
    }

    /*
     * Mobile: ocupa el 100% del ancho de la celda del grid.
     * Chrome visible: header (~56px) + "Ver más en Instagram" (~36px) = 92px
     * Aspect ratio 9/17 ≈ height = ancho × 1.889, lo cual cubre
     * el video 9:16 (1.778) + 92px de chrome, cortando limpio
     * justo después de "Ver más en Instagram".
     */
    .insta-wrap--mobile {
      width: 100%;
      aspect-ratio: 9 / 19;
    }
  </style>
  
  <!-- <div class=" bg-tertiary">
    <svg width="100vw" height="150" viewBox="0 0 100vw 150" preserveAspectRatio="none" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M1442 0H0C99.3333 16.6667 380 50 708 50C1036 50 1334 16.6667 1442 0Z" fill="#91CAE9"/>
    </svg>
  </div> -->

    <style>
    /* Brands Grid Responsive System */
    .brands-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      width: 100%;
      max-width: 100%;
    }

    .logo-brand {
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 4px solid transparent;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      border-radius: 50%;
      flex-shrink: 0;
      width: 3.5rem;
      height: 3.5rem;
      aspect-ratio: 1/1;
    }

    .logo-brand:hover {
      transform: scale(1.05);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }

    .brand-logo-img {
      width: 2.5rem;
      height: 2.5rem;
      object-fit: contain;
    }

    /* Tablet: 768px - 1023px - Mantiene 3 columnas como mobile pero más grande */
    @media (min-width: 768px) {
      .brands-grid {
        grid-template-columns: repeat(3, 1fr);
        gap: 1.25rem;
      }
      
      .logo-brand {
        width: 4.5rem;
        height: 4.5rem;
      }
      
      .brand-logo-img {
        width: 3.25rem;
        height: 3.25rem;
      }
    }

    /* Desktop: 1024px+ - Cambia a 4 columnas como en la imagen */
    @media (min-width: 1024px) {
      .brands-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 1.5rem;
      }
      
      .logo-brand {
        width: 5rem;
        height: 5rem;
      }
      
      .brand-logo-img {
        width: 3.75rem;
        height: 3.75rem;
      }
    }

    /* Large Desktop: 1200px+ - Más grande */
    @media (min-width: 1200px) {
      .brands-grid {
        gap: 2rem;
      }
      
      .logo-brand {
        width: 6rem;
        height: 6rem;
      }
      
      .brand-logo-img {
        width: 4.5rem;
        height: 4.5rem;
      }
    }

    /* Extra Large: 1400px+ - Aún más grande */
    @media (min-width: 1400px) {
      .brands-grid {
        gap: 2.25rem;
      }
      
      .logo-brand {
        width: 6.5rem;
        height: 6.5rem;
      }
      
      .brand-logo-img {
        width: 5rem;
        height: 5rem;
      }
    }

    /* Ultra Large: 1600px+ - Máximo tamaño */
    @media (min-width: 1600px) {
      .brands-grid {
        gap: 2.5rem;
      }
      
      .logo-brand {
        width: 7rem;
        height: 7rem;
      }
      
      .brand-logo-img {
        width: 5.5rem;
        height: 5.5rem;
      }
    }
  </style>

  <section id="quiz" class="mt-[-100px] w-full h-auto flex flex-col items-center justify-center bg-tertiary py-12" transition:animate="slide">
      <div class="container mx-auto px-4">
        
        
        <div class="flex flex-col md:flex-row w-full gap-4 md:gap-8">
          <div class="w-full md:w-1/2  p-8 flex items-center justify-center md:min-h-[300px]">
            <div class="text-center">
              <LazyImage src="https://snack.yummiespromociones.com/snacksyummies/quizilustration.webp" alt='Ilustración quiz interactivo Snacks Yummies' class="w-full h-full object-cover object-center"/>
            </div>
          </div>
          
          <div class="w-full md:w-1/2 md:p-8 p-0 flex items-center justify-center md:min-h-[300px] ">
            <div class="text-center">
              <LazyImage src={homeAssets.quiz.title} alt='Título quiz - Descubre tu snack ideal' class="w-full h-full object-cover object-center"/>
              <p class="text-white  text-xl py-4 mb-6">{homeAssets.quiz.description}</p>
             
              <p>  <a href={homeAssets.quiz.urlButton} class="bg-white text-primary font-bold py-2 px-8 rounded-full">{homeAssets.quiz.button}</a></p>
            </div>
          
          </div>
        </div>
      </div>
    </section>

  <!-- <section id="recipes" class="w-full py-12 flex flex-col items-center justify-center" transition:animate="slide">
    <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-8 px-8 py-8 w-full">
      <div class="w-full md:w-1/2 flex flex-col justify-center items-center gap-4">
        <div class="flex flex-row items-center gap-8">
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/Sal.webp" alt="Sal para recetas mexicanas auténticas" class="w-12 object-cover object-center"/>
          <h3 class="text-5xl font-normal text-center text-white">TAQUE</h3>
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/pimienta.webp" alt="Pimienta para sazón mexicano" class="w-12 object-cover object-center"/>
        </div>
        <h3 class="text-5xl font-normal text-center text-white">RECETAS</h3>
        <p>
          <LazyImage src="https://snack.yummiespromociones.com/taqueritos/sarten.webp" alt="Sartén para recetas mexicanas con Taqueritos" class="w-80 object-cover object-center"/>
        </p>
      </div>
      <div class="w-full md:w-1/2 flex flex-col justify-center items-center gap-8">
        <a href={recipesAssets.explore_more.link} target="_blank" rel="noopener noreferrer" class="px-6 py-2 border border-white text-white font-medium rounded-full shadow-md hover:bg-blue-100 transition-colors duration-300 flex items-center justify-center">
          <span class="mr-2">{recipesAssets.explore_more.title}</span>
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10.293 5.293a1 1 0 011.414 0l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414-1.414L12.586 11H5a1 1 0 110-2h7.586l-2.293-2.293a1 1 0 010-1.414z" clip-rule="evenodd" />
          </svg>
        </a>
        <div id="allrecipes" class="grid grid-cols-2 md:grid-cols-2 gap-6 w-full px-4">
          {recipeItems.slice(0, 2).map((recipe: {
            id: string;
            title: string;
            image: string;
            preparation_time: number;
          }) => (
            <RecipeCard
              image={recipe.image}
              title={recipe.title}
              time={`${recipe.preparation_time}MIN`}
              id={recipe.id}
              textColor="text-white"
              iconColor="text-white"
            />
          ))}
        </div>
      </div>
    </div>
    <div class="md:w-full w-[80%] flex flex-wrap items-center justify-center gap-2 px-4 py-8 text-white font-bold text-md md:text-4xl font-sans font-weight-bold">
      <span>{recipesAssets.visit_text_1.title}</span>
      <a href={recipesAssets.visit_1.link} target="_blank" rel="noopener noreferrer" class="text-red">{recipesAssets.visit_1.title}</a>
      <span>{recipesAssets.visit_text_2.title}</span>
      <a href={recipesAssets.visit_2.link} target="_blank" rel="noopener noreferrer" class="text-red">{recipesAssets.visit_2.title}</a>
   
   
        <span>{recipesAssets.visit_text_3.title}</span>
        <a href={recipesAssets.visit_3.link} target="_blank" rel="noopener noreferrer" class="text-red">{recipesAssets.visit_3.title}</a>
        
    
    </div>
    </section> -->
    <script is:inline>
      // Simple slider for recipes
      function initRecipesSlider(){
        const viewport = document.getElementById('recipes-viewport');
        const track = document.getElementById('recipes-track');
        const prev = document.getElementById('recipes-prev');
        const next = document.getElementById('recipes-next');
        const dotsContainer = document.getElementById('recipes-dots');
        if (!viewport || !track || !prev || !next || !dotsContainer) return;

        const slides = Array.from(track.children);
        let currentPage = 0;
        let slidesPerView = 1;
        let totalPages = 1;

        // Create dots
        function buildDots(){
          dotsContainer.innerHTML = '';
          for(let i=0;i<totalPages;i++){
            const dot = document.createElement('button');
            dot.className = 'w-2.5 h-2.5 rounded-full bg-white/60 hover:bg-white transition-colors';
            dot.setAttribute('aria-label', `Go to page ${i + 1}`);
            dot.addEventListener('click', () => goTo(i));
            dotsContainer.appendChild(dot);
          }
        }

        function updateDots() {
          dotsContainer.querySelectorAll('button').forEach((el, idx) => {
            el.style.opacity = idx === currentPage ? '1' : '0.6';
            el.style.width = idx === currentPage ? '12px' : '10px';
            el.style.height = idx === currentPage ? '12px' : '10px';
          });
        }

        function goTo(pageIndex) {
          currentPage = (pageIndex + totalPages) % totalPages;
          // Calcular el desplazamiento basado en el ancho de las tarjetas + gap
          const styles = getComputedStyle(track);
          const gapStr = styles.columnGap || styles.gap || '0';
          const gapPx = parseFloat(gapStr) || 0;
          const slideWidth = slides[0] ? parseFloat(slides[0].style.width) || 0 : 0;
          const offset = currentPage * slidesPerView * (slideWidth + gapPx);
          track.style.transform = `translateX(${-offset}px)`;
          updateDots();
        }

        function onResize() {
          // Determine slides per view by breakpoint - max 3 per slide
          const vw = window.innerWidth;
          slidesPerView = vw >= 1024 ? 3 : vw >= 640 ? 2 : 1;
          const styles = getComputedStyle(track);
          const gapStr = styles.columnGap || styles.gap || '0';
          const gapPx = parseFloat(gapStr) || 0;
          const totalGap = gapPx * (slidesPerView - 1);
          const slideWidth = (viewport.clientWidth - totalGap) / slidesPerView;
          slides.forEach((slide) => (slide).style.width = `${slideWidth}px`);
          // Calcular páginas exactas (9 recetas / 3 por vista = 3 páginas)
          totalPages = Math.max(1, Math.ceil(slides.length / slidesPerView));
          // Asegurar que currentPage no exceda el máximo
          if (currentPage >= totalPages) currentPage = totalPages - 1;
          buildDots();
          goTo(currentPage);
        }

        prev.addEventListener('click', () => goTo(currentPage - 1));
        next.addEventListener('click', () => goTo(currentPage + 1));
        window.addEventListener('resize', onResize);
        onResize();
      }

      document.addEventListener('DOMContentLoaded', initRecipesSlider);
      document.addEventListener('astro:page-load', initRecipesSlider);
      document.addEventListener('astro:after-swap', initRecipesSlider);
