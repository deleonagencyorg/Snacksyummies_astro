---
/**
 * InstagramEmbed component - Optimizado
 * Renderiza posts de Instagram usando iframe estándar
 * @param {string} postUrl - URL del post de Instagram
 * @param {string} width - Ancho del contenedor (default: "100%")
 * @param {string} height - Alto del contenedor (default: "600px")
 * @param {string} className - Clases CSS adicionales
 */

export interface Props {
  postUrl: string;
  width?: string;
  height?: string;
  className?: string;
}

const { postUrl, width = "100%", height = "600px", className = "" } = Astro.props;

// Extraer el tipo y el ID del post de la URL
function extractInstagramTypeAndId(url: string): { type: 'p' | 'reel' | 'tv'; id: string } {
  // Patrones para diferentes formatos de URL de Instagram
  const patterns = [
    { regex: /instagram\.com\/p\/([\w-]+)/i, type: 'p' as const },        // Posts normales
    { regex: /instagram\.com\/reel\/([\w-]+)/i, type: 'reel' as const },  // Reels
    { regex: /instagram\.com\/tv\/([\w-]+)/i, type: 'tv' as const }       // IGTV
  ];
  
  for (const { regex, type } of patterns) {
    const match = url.match(regex);
    if (match && match[1]) {
      return { type, id: match[1].split(/\?|\//)[0] };
    }
  }
  
  // Si no se encuentra un ID, usar la última parte de la URL
  const urlParts = url.split('/');
  const id = urlParts[urlParts.length - 1].split('?')[0];
  // Asumir tipo 'p' por defecto
  return { type: 'p', id };
}

const { type, id } = extractInstagramTypeAndId(postUrl);
const embedUrl = `https://www.instagram.com/${type}/${id}/embed/`;
---

<div class={`instagram-embed ${className}`} style={{width, height, maxWidth: "100%", margin: "0 auto"}}>
  <iframe 
    src={embedUrl}
    width="100%" 
    height="100%" 
    frameborder="0" 
    scrolling="no" 
    allowtransparency="true"
    loading="lazy"
    title="Instagram Post"
  ></iframe>
</div>

<style>
  .instagram-embed {
    margin: 0 auto;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    min-height: 0; /* Let parent define height (e.g., aspect-ratio wrapper) */
  }
</style>
