---
// src/pages/[lang]/products/[productId].astro
import { t, setLocale, type Locale } from '../../../i18n/i18n';
import MainLayout from '../../../layouts/MainLayout.astro';
import ProductDetail from '../../../views/Products/Detail/index.astro';

export function getStaticPaths() {
  const locales = ['en'];
  const paths: Array<any> = [];

  for (const locale of locales) {
    const brands = (t('brands', { namespace: 'brands', locale: locale as Locale }) as any[]) || [];
    let count = 0;
    for (const brand of brands) {
      if (brand?.products && Array.isArray(brand.products)) {
        for (const p of brand.products) {
          const param = p.slug || p.id;
          if (!param) continue;
          paths.push({ params: { lang: locale, productId: String(param) } });
          count++;
        }
      }
    }
    console.log(`Generated ${count} product routes from brands for language ${locale}`);
  }

  return paths;
}

const { lang, productId } = Astro.params;

// Establecer el idioma para las traducciones
setLocale(lang as Locale);

console.log(`Rendering product: ${productId} in language: ${lang}`);
---

<MainLayout title={lang === 'es' ? 'Producto' : 'Product'}>
  <ProductDetail productId={productId} />
</MainLayout>
