---
import SocialShare from '../common/SocialShare.astro';

interface Props {
  promotion: any;
  currentLang: string;
  currentIndex?: number;
  totalItems?: number;
  onPrevious?: () => void;
  onNext?: () => void;
  isFinished?: boolean;
}

const { 
  promotion, 
  currentLang, 
  currentIndex = 0, 
  totalItems = 1,
  onPrevious,
  onNext,
  isFinished = false
} = Astro.props;

const formattedDate = (startDate: string, endDate: string) => {
  const start = new Date(startDate).toLocaleDateString(currentLang);
  const end = new Date(endDate).toLocaleDateString(currentLang);
  return `${start} - ${end}`;
};
// Safe background image to avoid undefined access during build
const bgDesktop: string = promotion?.image?.desktop ?? '';
---

<script>
  const prevButtons = document.querySelectorAll('.carousel-prev');
  const nextButtons = document.querySelectorAll('.carousel-next');
  
  prevButtons.forEach(button => {
    button.addEventListener('click', () => {
      const container = button.closest('.promo-carousel-container');
      const currentSlide = container?.querySelector('.promo-carousel-slide');
      // Add your slide navigation logic here
    });
  });
  
  nextButtons.forEach(button => {
    button.addEventListener('click', () => {
      const container = button.closest('.promo-carousel-container');
      const currentSlide = container?.querySelector('.promo-carousel-slide');
      // Add your slide navigation logic here
    });
  });
</script>

<div class="promo-carousel-container content-stretch flex flex-col gap-6 items-center justify-start relative w-full">
  <div class="content-stretch flex flex-col gap-6 items-center justify-start relative w-full">
    <div class={`promo-carousel-slide bg-white h-[471px] overflow-hidden relative rounded-[40px] w-full shadow-lg hover:shadow-xl transition-shadow ${isFinished ? 'opacity-75' : ''}`}>
      <div 
        class="absolute h-full left-0 top-0 w-[517px] bg-center bg-cover bg-no-repeat" 
        style={`background-image: url('${bgDesktop}')`}
      >
        {/* Image overlay for better text contrast */}
        <div class={`absolute inset-0 bg-gradient-to-r from-transparent to-white/10 ${isFinished ? 'bg-black/20' : ''}`}></div>
        {isFinished && (
          <div class="absolute top-4 right-4 bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold z-10">
            {currentLang === 'es' ? 'Finalizada' : 'Finished'}
          </div>
        )}
      </div>
      <div class="absolute flex flex-col gap-6 h-[471px] items-center justify-center left-[517px] p-8 top-1/2 -translate-y-1/2 w-[519px]">
        <div class="flex flex-col gap-4 items-center justify-start w-full px-4">
          <div class="flex gap-2 items-center justify-start">
            <div class="flex items-center justify-center w-6 h-6">
              <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-black">
                <path d="M19 4h-1V3c0-.6-.4-1-1-1s-1 .4-1 1v1H8V3c0-.6-.4-1-1-1s-1 .4-1 1v1H5C3.3 4 2 5.3 2 7v12c0 1.7 1.3 3 3 3h14c1.7 0 3-1.3 3-3V7c0-1.7-1.3-3-3-3zm1 15c0 .6-.4 1-1 1H5c-.6 0-1-.4-1-1V10h16v9zm0-11H4V7c0-.6.4-1 1-1h1v1c0 .6.4 1 1 1s1-.4 1-1V6h8v1c0 .6.4 1 1 1s1-.4 1-1V6h1c.6 0 1 .4 1 1v1z"/>
              </svg>
            </div>
            <p class="text-xl text-black">
                {isFinished ? (currentLang === 'es' ? 'Finalizada' : 'Finished') : formattedDate(promotion.startDate, promotion.endDate)}
            </p>
          </div>
          <h3 class="text-3xl font-sans text-black text-center leading-tight max-w-[90%]">
            {promotion.title}
          </h3>
          {promotion.subtitle && (
            <p class="text-sm text-gray-600 text-center text-wrap px-4">
              {promotion.subtitle}
            </p>
          )}
        </div>
        
        <a 
          href={promotion.buttonUrl}
          class={`text-xl px-8 py-4 rounded-full transition-colors ${
            isFinished 
              ? 'bg-gray-500 text-white hover:bg-gray-600' 
              : 'bg-[#00306f] text-white hover:bg-blue-900'
          }`}
        >
          {currentLang === 'es' ? 'Ver detalle' : 'View detail'}
        </a>
        
        <div class="flex gap-4 items-center justify-center">
          <span class="text-xl text-black">
            {currentLang === 'es' ? 'Comparte:' : 'Share:'}
          </span>
          <SocialShare 
            title={promotion.title}
            className="flex gap-3"
            buttonClassName="text-black hover:text-blue-600 transition-colors"
            platforms={['facebook', 'twitter', 'whatsapp']}
          />
        </div>
      </div>
    </div>
  </div>
  
  {/* Carousel Navigation */}
  <div class="flex gap-6 items-center justify-center mt-6">
    <button 
      class="carousel-prev w-8 h-8 flex items-center justify-center text-white hover:text-gray-200 transition-colors cursor-pointer"
      aria-label={currentLang === 'es' ? 'Anterior promoción' : 'Previous promotion'}
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M15 18l-6-6 6-6"/>
      </svg>
    </button>
    
    <div class="flex items-center gap-2">
      {Array.from({ length: totalItems }).map((_, index) => (
        <div class="w-10 h-10 flex items-center justify-center">
          <div 
            class={`w-4 h-4 rounded-full transition-colors ${index === currentIndex ? 'bg-white' : 'bg-[#a4aeb7] hover:bg-white/80'}`}
            role="button"
            aria-label={`${currentLang === 'es' ? 'Ir a promoción' : 'Go to promotion'} ${index + 1}`}
          />
        </div>
      ))}
    </div>
    
    <button 
      class="carousel-next w-8 h-8 flex items-center justify-center text-white hover:text-gray-200 transition-colors cursor-pointer"
      aria-label={currentLang === 'es' ? 'Siguiente promoción' : 'Next promotion'}
    >
      <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M9 18l6-6-6-6"/>
      </svg>
    </button>
  </div>
</div>
